<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Image Upload</title>
</head>
<body>
  <h1>WebSocket Image Upload Test</h1>
  <input type="file" id="imageInput" />
  <button id="uploadButton" disabled>Upload Image</button>
  <p id="status"></p>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    // Connect to the WebSocket server
    const socket = io('http://localhost:8180'); // Adjust the URL if needed

    // DOM elements
    const imageInput = document.getElementById('imageInput');
    const uploadButton = document.getElementById('uploadButton');
    const status = document.getElementById('status');

    let selectedFile = null;

    // Enable the upload button when a file is selected
    imageInput.addEventListener('change', (event) => {
      selectedFile = event.target.files[0];
      uploadButton.disabled = !selectedFile;
    });

    // Handle the upload button click
    uploadButton.addEventListener('click', () => {
      if (!selectedFile) {
        status.textContent = 'No file selected!';
        return;
      }

      // Read the file as binary
      const reader = new FileReader();
      reader.onload = () => {
        const binaryData = reader.result; // Binary data from the file

        // Emit the "image" event with the project ID and binary data
        const projectId = '12345'; // Replace with the desired project ID
        socket.emit('image', { projectId, imageData: binaryData });

        status.textContent = 'Uploading...';
      };

      reader.onerror = (error) => {
        console.error('Error reading file:', error);
        status.textContent = 'Failed to read file.';
      };

      // Read the file as an ArrayBuffer (binary format)
      reader.readAsArrayBuffer(selectedFile);
    });

    // Handle server acknowledgment
    socket.on('ack', (data) => {
      console.log('Server acknowledgment:', data);
      status.textContent = 'Image uploaded successfully!';
    });

    // Handle server errors
    socket.on('error', (error) => {
      console.error('Server error:', error);
      status.textContent = `Error: ${error.message || 'Unknown error'}`;
    });
  </script>
</body>
</html>
